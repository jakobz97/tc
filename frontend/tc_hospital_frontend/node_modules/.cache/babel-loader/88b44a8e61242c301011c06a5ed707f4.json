{"ast":null,"code":"var _jsxFileName = \"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/code/frontend/tc_hospital_frontend/src/components/coder/editor/Editor.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { fromRange } from \"xpath-range\";\nimport { v4 as uuidv4 } from 'uuid';\nimport Navbar from \"../../general/navbar/Navbar\";\nimport UploadFadeIn from \"./UploadFadeIn\";\nimport '../../../styles/shared/main.css';\nimport '../../../styles/shared/editor/editor.css';\nimport \"../../../slice/authSlice\";\nimport { codeCompletionAsync, uploadCodeAsync } from \"../../../slice/reviewSlice\";\nimport { history } from \"../../../helpers/history\";\nimport { useDispatch } from \"react-redux\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Editor = () => {\n  _s();\n\n  const [txt, setTxt] = useState(\"Die wichtigste Klassifikation für klinische Diagnosen ist die Internationale statistische Klassifikation der Krankheiten und verwandter Gesundheitsprobleme (International Statistical Classification of Diseases and Related Health Problems, ICD). Sie wird von der WHO (World Health Organization) herausgegeben und weltweit für die Diagnosendokumentation, Todesursachenstatistik und andere medizinische Statistiken verwendet.\\n\" + \"\\n\" + \"Erste Versuche mit einer Klassifikation von Krankheiten bzw. Todesursachen gab es bereits im 18. Jahrhundert. So hat der Probst Johann Peter Süßmilch (1707-1767) eine Todesursachenstatistik für Berlin mit mehr als 80.000 Fällen veröffentlicht. Im 19. Jahrhundert wurde versucht, die Kenntnis über die Häufigkeit verschiedener Todesursachen in soziale Maßnahmen einfließen zu lassen. 1893 wurde im Auftrag des Internationalen Statistischen Instituts von dem Direktor des statistischen Amtes von Paris, Dr. Jacques Bertillot, ein systematisches Todesursachen-Verzeichnis vorgelegt, in das Erfahrungen aus Frankreich, England, Deutschland und der Schweiz eingingen. Als Grundlage diente das Prinzip der Unterscheidung zwischen Allgemeinkrankheiten und lokalisierten Organerkrankungen. Bis 1938 gab es fünf Revisionen dieses Todesursachen-Verzeichnisses. Seit 1946 liegt die Verantwortung für die ICD bei der Weltgesundheitsorganisation WHO. Neben der Definition des Verzeichnisses (6. Revision) einigte man sich damals auch auf internationale Vorschriften zur Feststellung des Grundleidens und auf die Annahme eines umfassenden Programms der internationalen Zusammenarbeit auf dem Gebiet der Bevölkerungs- und Gesundheitsstatistik.\\n\" + \"\\n\" + \"Nach umfangreichen Vorarbeiten zu Inhalt, Aufbau und Verwendungszweck der ICD wurde 1987 die 10. Revision (ICD-10) von der WHO-Vollversammlung verabschiedet. Diese Version wird weltweit für die Gesundheitsstatistik verwendet und erlaubt damit Vergleiche zwischen einzelnen Ländern. Die deutsche Fassung wird von dem Deutschen Institut für Medizinische Dokumentation und Information (DIMDI) in Köln herausgegeben. Für die Todesursachenstatistik wird die ICD-10 in Deutschland seit dem 1.1.1998 eingesetzt (ICD-10-WHO). Die aktuelle Fassung für die stationäre und vertragsärztliche ambulante Gesundheitsversorgung wird als Version ICD-10-GM (German Modification) bezeichnet. Sie enthält eine Reihe von Modifikationen für das deutsche Gesundheitssystem, insbesondere Anpassungen für die Abrechnung stationärer Leistungen mit dem diagnose-orientierten Fallpauschalensystem (DRG-System).\\n\" + \"\\n\" + \"Die ICD-10 ist als numerische (d.h. Gliederung nach Schlüsseln) und alphabetische (d.h. Gliederung nach Krankheitsbezeichnungen) Klassifikation zusammen mit den Regeln ihrer Anwendung im Buchhandel erhältlich. Die alphabetische Klassifikation wird auch als Diagnosenthesaurus bezeichnet. Die aktuelle Version der ICD-10 kann in beiden Formen auf der WWW-Seite des DIMDI gelesen werden.\");\n  const [selTxt, setSelTxt] = useState({});\n  const [tempCodes, setTempCodes] = useState([]);\n  const [finalUploadStage, setFinalUploadStage] = useState(false);\n  const dispatch = useDispatch(); //todo security checks\n\n  /**\n   * @function (01) adjust the code display height based on the code input\n   *           (02) adjust the height of the empty editor\n   */\n\n  useEffect(() => {\n    //01\n    document.getElementById('internal_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight + 'px'; //02\n\n    document.getElementsByClassName('empty_editor')[0].style.height = document.getElementsByClassName('code_input')[0].offsetHeight + 'px';\n  }, []);\n  /**\n   * @function (01) define the target by choosing the complementary of the scrolled div\n   *           (02) assign scroll toü and scroll left to the target based on the event scrolled position\n   */\n\n  const syncScroll = (e, origin) => {\n    //01\n    const target = origin === 'display' ? document.getElementsByClassName('code_input')[0] : document.getElementsByClassName('code_display')[0]; //02\n\n    target.scrollTop = e.currentTarget.scrollTop;\n    target.scrollLeft = e.currentTarget.scrollLeft;\n  }; //==================================================\n\n  /**\n   * @function (01) check that there is no overlapping regarding the codes\n   *           (02) highlight the code\n   *           (03) push into data structure (updates the code overview on the right side)\n   */\n\n\n  const addCode = () => {\n    //01\n    let startOverlapCheck = tempCodes.filter(code => selTxt.start > code.start && selTxt.start < code.end);\n    let endOverlapCheck = tempCodes.filter(code => selTxt.end < code.end && selTxt.end > code.start); //todo check that this code has not been used yet\n\n    if (startOverlapCheck.length > 0 || endOverlapCheck.length > 0) return alert('No overlaps possbile'); //02\n\n    setSelectionRange(selTxt.start, selTxt.end); //highlight(\"yellow\");\n    //03\n\n    setTempCodes(currentCodes => [...currentCodes, selTxt]);\n  };\n  /**\n   * @function (00) wait until typing ended and dispatch send to backend for code completion and wait\n   *           (01) duplicate the array\n   *           (02) find the array entry by index\n   *           (03) add code to this entry\n   * @param e is the event\n   * @param i is the index of the array element which is\n   * @param type either id or desc of the code - required for the autocompletion\n   */\n\n\n  let typingTimerEdit;\n\n  const editCode = (e, i, type) => {\n    //00\n    clearTimeout(typingTimerEdit);\n    if (!e.target.value) return;\n    typingTimerEdit = setTimeout(() => {\n      dispatch(codeCompletionAsync({\n        type: type,\n        val: e.target.value\n      })).then(res => {\n        if (res.payload.matches.length !== 1) {\n          document.getElementsByClassName('ind_code_display')[i].style.border = \"1px solid red\";\n          return document.getElementsByClassName('large_code_section')[i].value = 'Zu viele Ergebnisse - ' + res.payload.matches.length;\n        } //01\n\n\n        let newArr = [...tempCodes]; //02\n\n        let mergedObj = { ...newArr[i],\n          icdCode: e.target.value,\n          icdCodeDesc: res.payload.matches[0][2]\n        };\n        newArr[i] = mergedObj; //03\n\n        setTempCodes(newArr); //04\n\n        document.getElementsByClassName('large_code_section')[i].value = res.payload.matches[0][2]; //05\n\n        document.getElementsByClassName('ind_code_display')[i].style.border = \"none\";\n      }).catch(err => {\n        console.log(err);\n      });\n    }, 1000);\n  };\n  /**\n   * @function (01) duplicate the array\n   *           (02) splice the array\n   *           (03) set the new temp codes\n   * @param i index of the highlight which is deleted\n   */\n\n\n  const removeTxt = i => {\n    let newArr = [...tempCodes]; //02\n\n    newArr.splice(i, 1); //03\n\n    setTempCodes(newArr);\n  }; //==================================================\n\n  /**\n   * @function (01) get all selects and positions\n   *           (02) if only cursor change takes place only hide the tooltip\n   *           (03) reposition tooltip\n   *           (04) set selected text state\n   */\n\n\n  const selector = e => {\n    //01\n    let select = window.getSelection(),\n        selectRange = select.getRangeAt(0),\n        selectPos = selectRange.getBoundingClientRect(),\n        codeInput = document.getElementsByClassName('code_input')[0],\n        codeInputPos = codeInput.getBoundingClientRect(),\n        tooltip = document.getElementById('tooltip_editor_wrapper'); //02\n\n    if (selectPos.width < 1) return tooltip.style.display = \"none\"; //03\n\n    tooltip.style.display = \"inline\";\n    tooltip.style.top = selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop + 'px';\n    tooltip.style.left = selectPos.left - codeInputPos.left + selectPos.width / 2 - tooltip.offsetWidth / 2 + 'px'; //04\n\n    let xpath = fromRange(selectRange, codeInput);\n    setSelTxt({ ...selTxt,\n      ...{\n        val: selectRange.toString(),\n        start: xpath.startOffset,\n        end: xpath.endOffset,\n        id: uuidv4(),\n        top: selectPos.top - codeInputPos.top + codeInput.scrollTop - 5\n      }\n    });\n  };\n  /**\n   * @function (01)\n   *           (02)\n   * @param start\n   * @param end\n   */\n\n\n  function setSelectionRange(start, end) {\n    let el = document.getElementsByClassName('code_input')[0];\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    var textNodes = getTextNodesIn(el);\n    var foundStart = false;\n    var charCount = 0,\n        endCharCount;\n\n    for (var i = 0, textNode; textNode = textNodes[i++];) {\n      endCharCount = charCount + textNode.length;\n\n      if (!foundStart && start >= charCount && (start < endCharCount || start == endCharCount && i <= textNodes.length)) {\n        range.setStart(textNode, start - charCount);\n        foundStart = true;\n      }\n\n      if (foundStart && end <= endCharCount) {\n        range.setEnd(textNode, end - charCount);\n        break;\n      }\n\n      charCount = endCharCount;\n    }\n\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range); //Helper functions\n\n    function getTextNodesIn(node) {\n      var textNodes = [];\n\n      if (node.nodeType === 3) {\n        textNodes.push(node);\n      } else {\n        var children = node.childNodes;\n\n        for (var i = 0, len = children.length; i < len; ++i) {\n          textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n        }\n      }\n\n      return textNodes;\n    }\n  }\n  /**\n   * @function\n   * @param colour\n   */\n\n\n  function highlight(colour) {\n    let range, sel;\n    sel = window.getSelection();\n\n    if (sel.rangeCount && sel.getRangeAt) {\n      range = sel.getRangeAt(0);\n    }\n\n    document.designMode = \"on\";\n    sel.removeAllRanges();\n    sel.addRange(range);\n    document.execCommand(\"BackColor\", false, colour);\n    document.designMode = \"off\";\n  } //==================================================\n\n  /**\n   * @function (01) check if any codes were added - if not return\n   *           (02) fade in the final upload overview - where tags, difficulty, internal use and title are provided\n   */\n\n\n  const proceedUpload = () => {\n    //01\n    if (tempCodes.length < 1) return alert(\"please provide at least one code\"); //02\n\n    setFinalUploadStage(true);\n  };\n  /**\n   * @function\n   */\n\n\n  const abortUpload = () => {};\n  /**\n   * @function (01) prevent default\n   *           (02) create a merged object of text, codes\n   *           (03) upload via dispatch and wait for success\n   *           (04) on success clear the view and let user create a new\n   */\n\n\n  const uploadCodes = e => {\n    //01\n    e.preventDefault();\n    setFinalUploadStage(false); //02\n\n    let codeDataObj = {\n      initialCodes: tempCodes,\n      txt: txt,\n      ...Object.fromEntries(new FormData(e.target))\n    }; //03\n\n    dispatch(uploadCodeAsync(codeDataObj)).then(res => {\n      console.log(res.payload); //04\n    }).catch(err => {\n      console.log('error', err);\n    });\n  };\n  /**\n   * @function\n   */\n\n\n  const exportCodes = () => {\n    alert('export the codes');\n  }; // ==========================\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"center_container\",\n    children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main_center_content_wrapper\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_outer_content\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"main_outer_heading\",\n          children: \"Code editor\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_center_content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"code_input\",\n          placeholder: \"Patientendokumentation\",\n          contentEditable: \"true\",\n          onSelect: selector,\n          onScroll: e => syncScroll(e, 'input'),\n          children: [txt, /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"tooltip_editor_wrapper\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"tooltip_btn\",\n              onClick: addCode,\n              children: \"Code hinzuf\\xFCgen\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 299,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"code_display\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"internal_code_display\",\n            onScroll: e => syncScroll(e, 'input'),\n            children: tempCodes.length > 0 ? tempCodes.map((code, i) => {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ind_code_display\",\n                id: code.id,\n                style: {\n                  top: code.top + 'px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Code ID\",\n                  className: \"small_code_section\",\n                  onChange: e => editCode(e, i, 'id')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 308,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  placeholder: \"Code Desc\",\n                  className: \"large_code_section\",\n                  readOnly: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 309,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"remove_code_btn\",\n                  onClick: () => removeTxt(i),\n                  children: \"X\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 310,\n                  columnNumber: 41\n                }, this)]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 307,\n                columnNumber: 44\n              }, this);\n            }) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"empty_editor\",\n              children: \"Vergebe Codes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 21\n        }, this), finalUploadStage && /*#__PURE__*/_jsxDEV(UploadFadeIn, {\n          submit: uploadCodes,\n          close: () => setFinalUploadStage(false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 42\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_outer_content right_bound_outer_content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"editor_submit_btn\",\n          onClick: () => exportCodes(),\n          children: \"Codes exportieren\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 21\n        }, this), !finalUploadStage && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"editor_submit_btn highlighted_editor_submit_btn\",\n          onClick: () => proceedUpload(),\n          children: \"Hochladen\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 43\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 287,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Editor, \"e8xDaf3Qjg2UJU+KKVGcDdlyCw4=\", false, function () {\n  return [useDispatch];\n});\n\n_c = Editor;\nexport default Editor;\n\nvar _c;\n\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"sources":["/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/code/frontend/tc_hospital_frontend/src/components/coder/editor/Editor.js"],"names":["React","useState","useRef","useEffect","fromRange","v4","uuidv4","Navbar","UploadFadeIn","codeCompletionAsync","uploadCodeAsync","history","useDispatch","Editor","txt","setTxt","selTxt","setSelTxt","tempCodes","setTempCodes","finalUploadStage","setFinalUploadStage","dispatch","document","getElementById","style","height","getElementsByClassName","scrollHeight","offsetHeight","syncScroll","e","origin","target","scrollTop","currentTarget","scrollLeft","addCode","startOverlapCheck","filter","code","start","end","endOverlapCheck","length","alert","setSelectionRange","currentCodes","typingTimerEdit","editCode","i","type","clearTimeout","value","setTimeout","val","then","res","payload","matches","border","newArr","mergedObj","icdCode","icdCodeDesc","catch","err","console","log","removeTxt","splice","selector","select","window","getSelection","selectRange","getRangeAt","selectPos","getBoundingClientRect","codeInput","codeInputPos","tooltip","width","display","top","left","offsetWidth","xpath","toString","startOffset","endOffset","id","el","range","createRange","selectNodeContents","textNodes","getTextNodesIn","foundStart","charCount","endCharCount","textNode","setStart","setEnd","sel","removeAllRanges","addRange","node","nodeType","push","children","childNodes","len","apply","highlight","colour","rangeCount","designMode","execCommand","proceedUpload","abortUpload","uploadCodes","preventDefault","codeDataObj","initialCodes","Object","fromEntries","FormData","exportCodes","map"],"mappings":"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","sourcesContent":["import React, {useState, useRef, useEffect} from \"react\";\nimport { fromRange } from \"xpath-range\"\nimport { v4 as uuidv4 } from 'uuid';\n\nimport Navbar from \"../../general/navbar/Navbar\";\nimport UploadFadeIn from \"./UploadFadeIn\";\n\nimport '../../../styles/shared/main.css';\nimport '../../../styles/shared/editor/editor.css';\n\nimport {} from \"../../../slice/authSlice\";\nimport {codeCompletionAsync, uploadCodeAsync} from \"../../../slice/reviewSlice\";\nimport {history} from \"../../../helpers/history\";\n\n\nimport {useDispatch} from \"react-redux\";\n\nconst Editor = () => {\n\n    const [txt, setTxt] = useState(\"Die wichtigste Klassifikation für klinische Diagnosen ist die Internationale statistische Klassifikation der Krankheiten und verwandter Gesundheitsprobleme (International Statistical Classification of Diseases and Related Health Problems, ICD). Sie wird von der WHO (World Health Organization) herausgegeben und weltweit für die Diagnosendokumentation, Todesursachenstatistik und andere medizinische Statistiken verwendet.\\n\" +\n        \"\\n\" +\n        \"Erste Versuche mit einer Klassifikation von Krankheiten bzw. Todesursachen gab es bereits im 18. Jahrhundert. So hat der Probst Johann Peter Süßmilch (1707-1767) eine Todesursachenstatistik für Berlin mit mehr als 80.000 Fällen veröffentlicht. Im 19. Jahrhundert wurde versucht, die Kenntnis über die Häufigkeit verschiedener Todesursachen in soziale Maßnahmen einfließen zu lassen. 1893 wurde im Auftrag des Internationalen Statistischen Instituts von dem Direktor des statistischen Amtes von Paris, Dr. Jacques Bertillot, ein systematisches Todesursachen-Verzeichnis vorgelegt, in das Erfahrungen aus Frankreich, England, Deutschland und der Schweiz eingingen. Als Grundlage diente das Prinzip der Unterscheidung zwischen Allgemeinkrankheiten und lokalisierten Organerkrankungen. Bis 1938 gab es fünf Revisionen dieses Todesursachen-Verzeichnisses. Seit 1946 liegt die Verantwortung für die ICD bei der Weltgesundheitsorganisation WHO. Neben der Definition des Verzeichnisses (6. Revision) einigte man sich damals auch auf internationale Vorschriften zur Feststellung des Grundleidens und auf die Annahme eines umfassenden Programms der internationalen Zusammenarbeit auf dem Gebiet der Bevölkerungs- und Gesundheitsstatistik.\\n\" +\n        \"\\n\" +\n        \"Nach umfangreichen Vorarbeiten zu Inhalt, Aufbau und Verwendungszweck der ICD wurde 1987 die 10. Revision (ICD-10) von der WHO-Vollversammlung verabschiedet. Diese Version wird weltweit für die Gesundheitsstatistik verwendet und erlaubt damit Vergleiche zwischen einzelnen Ländern. Die deutsche Fassung wird von dem Deutschen Institut für Medizinische Dokumentation und Information (DIMDI) in Köln herausgegeben. Für die Todesursachenstatistik wird die ICD-10 in Deutschland seit dem 1.1.1998 eingesetzt (ICD-10-WHO). Die aktuelle Fassung für die stationäre und vertragsärztliche ambulante Gesundheitsversorgung wird als Version ICD-10-GM (German Modification) bezeichnet. Sie enthält eine Reihe von Modifikationen für das deutsche Gesundheitssystem, insbesondere Anpassungen für die Abrechnung stationärer Leistungen mit dem diagnose-orientierten Fallpauschalensystem (DRG-System).\\n\" +\n        \"\\n\" +\n        \"Die ICD-10 ist als numerische (d.h. Gliederung nach Schlüsseln) und alphabetische (d.h. Gliederung nach Krankheitsbezeichnungen) Klassifikation zusammen mit den Regeln ihrer Anwendung im Buchhandel erhältlich. Die alphabetische Klassifikation wird auch als Diagnosenthesaurus bezeichnet. Die aktuelle Version der ICD-10 kann in beiden Formen auf der WWW-Seite des DIMDI gelesen werden.\")\n    const [selTxt, setSelTxt] = useState({})\n    const [tempCodes, setTempCodes] = useState([])\n    const [finalUploadStage, setFinalUploadStage] = useState(false)\n\n    const dispatch = useDispatch();\n\n    //todo security checks\n\n    /**\n     * @function (01) adjust the code display height based on the code input\n     *           (02) adjust the height of the empty editor\n     */\n    useEffect(() => {\n        //01\n        document.getElementById('internal_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight+'px';\n        //02\n        document.getElementsByClassName('empty_editor')[0].style.height = document.getElementsByClassName('code_input')[0].offsetHeight+'px'\n    }, [])\n\n    /**\n     * @function (01) define the target by choosing the complementary of the scrolled div\n     *           (02) assign scroll toü and scroll left to the target based on the event scrolled position\n     */\n    const syncScroll = (e, origin) => {\n        //01\n        const target = origin === 'display' ? document.getElementsByClassName('code_input')[0] : document.getElementsByClassName('code_display')[0]\n        //02\n        target.scrollTop = e.currentTarget.scrollTop;\n        target.scrollLeft = e.currentTarget.scrollLeft;\n    }\n\n    //==================================================\n\n    /**\n     * @function (01) check that there is no overlapping regarding the codes\n     *           (02) highlight the code\n     *           (03) push into data structure (updates the code overview on the right side)\n     */\n    const addCode = () => {\n        //01\n        let startOverlapCheck = tempCodes.filter(code => selTxt.start > code.start && selTxt.start < code.end)\n        let endOverlapCheck = tempCodes.filter(code => selTxt.end < code.end && selTxt.end > code.start)\n        //todo check that this code has not been used yet\n        if (startOverlapCheck.length > 0 || endOverlapCheck.length > 0) return alert('No overlaps possbile')\n        //02\n        setSelectionRange(selTxt.start, selTxt.end)\n        //highlight(\"yellow\");\n        //03\n        setTempCodes(currentCodes => [...currentCodes, selTxt]);\n    }\n\n    /**\n     * @function (00) wait until typing ended and dispatch send to backend for code completion and wait\n     *           (01) duplicate the array\n     *           (02) find the array entry by index\n     *           (03) add code to this entry\n     * @param e is the event\n     * @param i is the index of the array element which is\n     * @param type either id or desc of the code - required for the autocompletion\n     */\n    let typingTimerEdit;\n    const editCode = (e, i, type) => {\n        //00\n        clearTimeout(typingTimerEdit);\n        if (!e.target.value) return;\n        typingTimerEdit = setTimeout(() => {\n            dispatch(codeCompletionAsync({type: type, val: e.target.value}))\n                .then((res) => {\n                    if (res.payload.matches.length !== 1) {\n                        document.getElementsByClassName('ind_code_display')[i].style.border = \"1px solid red\";\n                        return document.getElementsByClassName('large_code_section')[i].value = 'Zu viele Ergebnisse - '+res.payload.matches.length\n                    }\n                    //01\n                    let newArr = [...tempCodes];\n                    //02\n                    let mergedObj = {...newArr[i], icdCode: e.target.value, icdCodeDesc: res.payload.matches[0][2]}\n                    newArr[i] = mergedObj;\n                    //03\n                    setTempCodes(newArr);\n                    //04\n                    document.getElementsByClassName('large_code_section')[i].value = res.payload.matches[0][2]\n                    //05\n                    document.getElementsByClassName('ind_code_display')[i].style.border = \"none\";\n                })\n                .catch((err) => {\n                    console.log(err)\n                });\n        }, 1000);\n    }\n\n    /**\n     * @function (01) duplicate the array\n     *           (02) splice the array\n     *           (03) set the new temp codes\n     * @param i index of the highlight which is deleted\n     */\n    const removeTxt = (i) => {\n        let newArr = [...tempCodes];\n        //02\n        newArr.splice(i, 1);\n        //03\n        setTempCodes(newArr);\n    }\n\n    //==================================================\n\n    /**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */\n    const selector = (e) => {\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('code_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                id: uuidv4(),\n                top: selectPos.top - codeInputPos.top + codeInput.scrollTop - 5\n            },\n        })\n    }\n\n    /**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */\n    function setSelectionRange(start, end) {\n\n        let el = document.getElementsByClassName('code_input')[0];\n\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var textNodes = getTextNodesIn(el);\n        var foundStart = false;\n        var charCount = 0, endCharCount;\n\n        for (var i = 0, textNode; textNode = textNodes[i++]; ) {\n            endCharCount = charCount + textNode.length;\n            if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i <= textNodes.length))) {\n                range.setStart(textNode, start - charCount);\n                foundStart = true;\n            }\n            if (foundStart && end <= endCharCount) {\n                range.setEnd(textNode, end - charCount);\n                break;\n            }\n            charCount = endCharCount;\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n\n        //Helper functions\n\n        function getTextNodesIn(node) {\n            var textNodes = [];\n            if (node.nodeType === 3) {\n                textNodes.push(node);\n            } else {\n                var children = node.childNodes;\n                for (var i = 0, len = children.length; i < len; ++i) {\n                    textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n                }\n            }\n            return textNodes;\n        }\n    }\n\n    /**\n     * @function\n     * @param colour\n     */\n    function highlight(colour) {\n\n        let range, sel;\n\n        sel = window.getSelection();\n        if (sel.rangeCount && sel.getRangeAt) {\n            range = sel.getRangeAt(0);\n        }\n        document.designMode = \"on\";\n        sel.removeAllRanges();\n        sel.addRange(range);\n        document.execCommand(\"BackColor\", false, colour);\n        document.designMode = \"off\";\n    }\n\n    //==================================================\n\n    /**\n     * @function (01) check if any codes were added - if not return\n     *           (02) fade in the final upload overview - where tags, difficulty, internal use and title are provided\n     */\n    const proceedUpload = () => {\n        //01\n        if (tempCodes.length < 1) return alert(\"please provide at least one code\");\n        //02\n        setFinalUploadStage(true);\n    }\n\n    /**\n     * @function\n     */\n    const abortUpload = () => {\n\n    }\n\n    /**\n     * @function (01) prevent default\n     *           (02) create a merged object of text, codes\n     *           (03) upload via dispatch and wait for success\n     *           (04) on success clear the view and let user create a new\n     */\n    const uploadCodes = (e) => {\n        //01\n        e.preventDefault();\n        setFinalUploadStage(false);\n        //02\n        let codeDataObj = {initialCodes: tempCodes, txt: txt, ...Object.fromEntries(new FormData(e.target))}\n        //03\n        dispatch(uploadCodeAsync(codeDataObj))\n            .then((res) => {\n                console.log(res.payload)\n                //04\n            })\n            .catch((err) => {\n                console.log('error', err)\n            })\n    }\n\n    /**\n     * @function\n     */\n    const exportCodes = () => {\n        alert('export the codes')\n    }\n\n    // ==========================\n\n    return (\n        <div className=\"center_container\">\n            <Navbar />\n            <div className=\"main_center_content_wrapper\">\n\n                <div className=\"main_outer_content\">\n                    <div className=\"main_outer_heading\">Code editor</div>\n                </div>\n\n                <div className=\"main_center_content\">\n                    <div className=\"code_input\" placeholder=\"Patientendokumentation\" contentEditable=\"true\" onSelect={selector} onScroll={(e) => syncScroll(e, 'input')}>\n                        {txt}\n                        <div id=\"tooltip_editor_wrapper\">\n                            <div className=\"tooltip_btn\" onClick={addCode}>Code hinzufügen</div>\n                        </div>\n                    </div>\n                    <div className=\"code_display\">\n                        <div id=\"internal_code_display\" onScroll={(e) => syncScroll(e, 'input')}>\n                        {\n                            tempCodes.length > 0 ? (\n                                tempCodes.map((code, i) => {\n                                    return <div className=\"ind_code_display\" id={code.id} style={{top:code.top+'px'}} key={i}>\n                                        <input placeholder=\"Code ID\" className=\"small_code_section\" onChange={(e) => editCode(e, i, 'id')}/>\n                                        <input placeholder=\"Code Desc\" className=\"large_code_section\" readOnly/>\n                                        <div className=\"remove_code_btn\" onClick={() => removeTxt(i)}>X</div>\n                                    </div>;\n                                })\n                            ) : (\n                                <div className=\"empty_editor\">Vergebe Codes</div>\n                            )\n                        }\n                        </div>\n                    </div>\n                    {finalUploadStage && <UploadFadeIn submit = {uploadCodes} close = {() => setFinalUploadStage(false)}/>}\n                </div>\n\n                <div className=\"main_outer_content right_bound_outer_content\">\n                    <div className=\"editor_submit_btn\" onClick={() => exportCodes()}>Codes exportieren</div>\n                    {!finalUploadStage && <div className=\"editor_submit_btn highlighted_editor_submit_btn\" onClick={() => proceedUpload()}>Hochladen</div>}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}