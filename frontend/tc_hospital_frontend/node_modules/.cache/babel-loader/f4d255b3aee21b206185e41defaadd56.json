{"ast":null,"code":"import _toConsumableArray from\"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import'../../../styles/shared/editor/editor.css';import'../../../styles/shared/fadein.css';import accept from\"../../../assets/general/accept.svg\";import decline from\"../../../assets/general/decline.svg\";import{getProposalsAsync,modifyProposalsAsync}from\"../../../slice/reviewSlice\";import{useDispatch,useSelector}from\"react-redux\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DetailedAnalytics=function DetailedAnalytics(_ref){var data=_ref.data,close=_ref.close;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loadedTxt=_useState2[0],setLoadedTxt=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),codeData=_useState4[0],setCodeData=_useState4[1];var dispatch=useDispatch();/**\n     * @function (01) get the dark background, the content wrapper and the inputs\n     *           (02) increase the dark background opacity\n     *           (03) fade up the content wrapper\n     *           =============\n     *           (04) insert the feature rich txt\n     *           (05) show the tooltip\n     *           (06) ensure that the code display has the same length as the overflow text\n     *           (07) ensure that the empty codes text is centered\n     *           (08) process the provided codes to display them\n     */useEffect(function(){//01\nvar bg=document.querySelector('.menu_dark_bg'),content=document.querySelector('.create_input_wrapper');//02\nbg.style.cssText=\"opacity: 100%\";//03\ncontent.style.marginTop=\"0\";//04\ndocument.getElementsByClassName('code_input')[0].innerHTML=data.txt;//05\nsetLoadedTxt(true);//06\ndocument.getElementById('internal_code_display').style.height=document.getElementsByClassName('code_input')[0].scrollHeight+'px';//07\ndocument.getElementsByClassName('empty_editor')[0].style.height=document.getElementsByClassName('code_input')[0].offsetHeight+'px';//08\nfetchProposals();},[]);/**\n     * @function (01) get the background and content\n     *           (02) return if user clicked on the content\n     *           (03) user clicked outside of content - hide\n     *           (04) after timeout set state again to hidden\n     */var hideView=function hideView(e,forced){//01\nvar bg=document.querySelector('.menu_dark_bg'),content=document.querySelector('.create_input_wrapper');//02\nif(!forced&&content.contains(e.target))return;//03\nbg.style.cssText=\"opacity: 0%\";content.style.marginTop=\"150vh\";//04\nsetTimeout(function(){return close();},350);};/**\n     * @function (01) define the target by choosing the complementary of the scrolled div\n     *           (02) assign scroll toü and scroll left to the target based on the event scrolled position\n     */var syncScroll=function syncScroll(e,origin){//01\nvar target=origin==='display'?document.getElementsByClassName('code_input')[0]:document.getElementsByClassName('code_display')[0];//02\ntarget.scrollTop=e.currentTarget.scrollTop;target.scrollLeft=e.currentTarget.scrollLeft;};//====================================================================\n/**\n     * @function (01) fetch the proposals\n     *           (02) merge into state array\n     */var fetchProposals=function fetchProposals(){dispatch(getProposalsAsync({reviewId:data._id})).then(function(res){//02\nvar proposalArr=res.payload.proposals.map(function(proposal){return _objectSpread(_objectSpread({},proposal.proposedCode),{id:proposal._id,studentId:proposal.senderId});});setCodeData(proposalArr);}).catch(function(err){console.log('err',err);});};/**\n     * @function (01) form proposalData object\n     *           (02) dispatch to the backend\n     *           (03) remove the code from the local state once the dispatch was successful\n     *           (04) decrement the proposal counter\n     * @param code is the affected code data object\n     * @param action either accept or decline of the proposal\n     * @param index is the index of the proposal within the codedata data structure\n     */var modifyProposal=function modifyProposal(action,code,index){var newCodeData=_toConsumableArray(codeData);newCodeData.splice(index,1);setCodeData(newCodeData);return;//01\nvar codeProposal={reviewId:data._id,tempCodes:code,userId:code.studentId,action:action,proposalId:code.id};//02\ndispatch(modifyProposalsAsync(codeProposal)).then(function(res){//03\nvar newCodeData=_toConsumableArray(codeData);newCodeData.splice(index,1);setCodeData(newCodeData);//04\n}).catch(function(err){console.log('err',err);});//test\n};//====================================================================\n/**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */var selector=function selector(e){/*\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('code_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                top: selectPos.top - codeInputPos.top + codeInput.scrollTop - 5,\n                id: uuidv4()\n            },\n        })\n         */};/**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */function setSelectionRange(start,end){var el=document.getElementsByClassName('code_input')[0];var range=document.createRange();range.selectNodeContents(el);var textNodes=getTextNodesIn(el);var foundStart=false;var charCount=0,endCharCount;for(var i=0,textNode;textNode=textNodes[i++];){endCharCount=charCount+textNode.length;if(!foundStart&&start>=charCount&&(start<endCharCount||start==endCharCount&&i<=textNodes.length)){range.setStart(textNode,start-charCount);foundStart=true;}if(foundStart&&end<=endCharCount){range.setEnd(textNode,end-charCount);break;}charCount=endCharCount;}var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);//Helper functions\nfunction getTextNodesIn(node){var textNodes=[];if(node.nodeType===3){textNodes.push(node);}else{var children=node.childNodes;for(var i=0,len=children.length;i<len;++i){textNodes.push.apply(textNodes,getTextNodesIn(children[i]));}}return textNodes;}}//====================================================================\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"menu_dark_bg\",onClick:hideView,children:/*#__PURE__*/_jsxs(\"div\",{className:\"create_input_wrapper enlarged_create_input_wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"create_input_hide\",onClick:function onClick(e){hideView(e,true);},children:\"X\"}),/*#__PURE__*/_jsx(\"div\",{className:\"code_input enlarged_code_input\",onScroll:function onScroll(e){return syncScroll(e,'input');},children:loadedTxt&&/*#__PURE__*/_jsx(\"div\",{id:\"tooltip_editor_wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"tooltip_btn\",children:\"Code hinzuf\\xFCgen\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"code_display enlarged_code_display\",onScroll:function onScroll(e){return syncScroll(e,'display');},children:/*#__PURE__*/_jsx(\"div\",{id:\"internal_code_display\",children:codeData.length>0?codeData.map(function(code,i){return/*#__PURE__*/_jsxs(\"div\",{className:\"ind_code_display\",id:code.id,style:{top:code.top+'px'},children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Code ID\",value:code.icdCode,className:\"small_code_section\",readOnly:true}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Code Desc\",value:code.icdCodeDesc,className:\"large_code_section medium_code_section\",readOnly:true}),/*#__PURE__*/_jsx(\"img\",{className:\"remove_code_btn\",onClick:function onClick(){return modifyProposal('decline',code,i);},src:decline}),/*#__PURE__*/_jsx(\"img\",{className:\"remove_code_btn\",onClick:function onClick(){return modifyProposal('accept',code,i);},src:accept})]},i);}):/*#__PURE__*/_jsx(\"div\",{className:\"empty_editor\",children:\"No proposals\"})})})]})});};export default DetailedAnalytics;","map":{"version":3,"sources":["/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/src/components/coder/reviews/ReviewEditor.js"],"names":["React","useEffect","useState","getProposalsAsync","modifyProposalsAsync","useDispatch","useSelector","DetailedAnalytics","data","close","loadedTxt","setLoadedTxt","codeData","setCodeData","dispatch","bg","document","querySelector","content","style","cssText","marginTop","getElementsByClassName","innerHTML","txt","getElementById","height","scrollHeight","offsetHeight","fetchProposals","hideView","e","forced","contains","target","setTimeout","syncScroll","origin","scrollTop","currentTarget","scrollLeft","reviewId","_id","then","res","proposalArr","payload","proposals","map","proposal","proposedCode","id","studentId","senderId","catch","err","console","log","modifyProposal","action","code","index","newCodeData","splice","codeProposal","tempCodes","userId","proposalId","selector","setSelectionRange","start","end","el","range","createRange","selectNodeContents","textNodes","getTextNodesIn","foundStart","charCount","endCharCount","i","textNode","length","setStart","setEnd","sel","window","getSelection","removeAllRanges","addRange","node","nodeType","push","children","childNodes","len","apply","top","icdCode","icdCodeDesc","decline","accept"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\n\nimport '../../../styles/shared/editor/editor.css';\nimport '../../../styles/shared/fadein.css';\nimport accept from '../../../assets/general/accept.svg';\nimport decline from '../../../assets/general/decline.svg';\n\nimport {getProposalsAsync, modifyProposalsAsync} from \"../../../slice/reviewSlice\";\nimport {useDispatch, useSelector} from \"react-redux\";\n\nconst DetailedAnalytics = ({ data, close }) => {\n\n    const [loadedTxt, setLoadedTxt] = useState(false);\n    const [codeData, setCodeData] = useState([]);\n\n    const dispatch = useDispatch();\n\n    /**\n     * @function (01) get the dark background, the content wrapper and the inputs\n     *           (02) increase the dark background opacity\n     *           (03) fade up the content wrapper\n     *           =============\n     *           (04) insert the feature rich txt\n     *           (05) show the tooltip\n     *           (06) ensure that the code display has the same length as the overflow text\n     *           (07) ensure that the empty codes text is centered\n     *           (08) process the provided codes to display them\n     */\n    useEffect(() => {\n        //01\n        let bg = document.querySelector('.menu_dark_bg'),\n            content = document.querySelector('.create_input_wrapper');\n        //02\n        bg.style.cssText = \"opacity: 100%\";\n        //03\n        content.style.marginTop = \"0\";\n        //04\n        document.getElementsByClassName('code_input')[0].innerHTML = data.txt;\n        //05\n        setLoadedTxt(true)\n        //06\n        document.getElementById('internal_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight+'px';\n        //07\n        document.getElementsByClassName('empty_editor')[0].style.height = document.getElementsByClassName('code_input')[0].offsetHeight+'px'\n        //08\n        fetchProposals();\n    }, [])\n\n    /**\n     * @function (01) get the background and content\n     *           (02) return if user clicked on the content\n     *           (03) user clicked outside of content - hide\n     *           (04) after timeout set state again to hidden\n     */\n    const hideView = (e, forced) => {\n        //01\n        let bg = document.querySelector('.menu_dark_bg'),\n            content = document.querySelector('.create_input_wrapper');\n        //02\n        if (!forced && content.contains(e.target)) return;\n        //03\n        bg.style.cssText = \"opacity: 0%\";\n        content.style.marginTop = \"150vh\";\n        //04\n        setTimeout(() => close(), 350)\n    };\n\n    /**\n     * @function (01) define the target by choosing the complementary of the scrolled div\n     *           (02) assign scroll toü and scroll left to the target based on the event scrolled position\n     */\n    const syncScroll = (e, origin) => {\n        //01\n        const target = origin === 'display' ? document.getElementsByClassName('code_input')[0] : document.getElementsByClassName('code_display')[0]\n        //02\n        target.scrollTop = e.currentTarget.scrollTop;\n        target.scrollLeft = e.currentTarget.scrollLeft;\n    }\n\n    //====================================================================\n\n    /**\n     * @function (01) fetch the proposals\n     *           (02) merge into state array\n     */\n    const fetchProposals = () => {\n        dispatch(getProposalsAsync({reviewId: data._id}))\n            .then((res) => {\n                //02\n                let proposalArr = res.payload.proposals.map(proposal => ({...proposal.proposedCode, ...{id:proposal._id, studentId: proposal.senderId}}));\n                setCodeData(proposalArr)\n            })\n            .catch((err) => {\n                console.log('err', err)\n            })\n    }\n\n    /**\n     * @function (01) form proposalData object\n     *           (02) dispatch to the backend\n     *           (03) remove the code from the local state once the dispatch was successful\n     *           (04) decrement the proposal counter\n     * @param code is the affected code data object\n     * @param action either accept or decline of the proposal\n     * @param index is the index of the proposal within the codedata data structure\n     */\n    const modifyProposal = (action, code, index) => {\n\n        let newCodeData = [...codeData];\n        newCodeData.splice(index, 1);\n        setCodeData(newCodeData)\n\n        return\n\n        //01\n        let codeProposal = {\n            reviewId: data._id,\n            tempCodes: code,\n            userId: code.studentId,\n            action: action,\n            proposalId:code.id\n        }\n        //02\n        dispatch(modifyProposalsAsync(codeProposal))\n            .then((res) => {\n                //03\n                let newCodeData = [...codeData];\n                newCodeData.splice(index, 1);\n                setCodeData(newCodeData)\n                //04\n\n            })\n            .catch((err) => {\n                console.log('err', err)\n            })\n        //test\n    }\n\n    //====================================================================\n\n    /**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */\n    const selector = (e) => {\n        /*\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('code_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                top: selectPos.top - codeInputPos.top + codeInput.scrollTop - 5,\n                id: uuidv4()\n            },\n        })\n         */\n    }\n\n    /**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */\n    function setSelectionRange(start, end) {\n\n        let el = document.getElementsByClassName('code_input')[0];\n\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var textNodes = getTextNodesIn(el);\n        var foundStart = false;\n        var charCount = 0, endCharCount;\n\n        for (var i = 0, textNode; textNode = textNodes[i++]; ) {\n            endCharCount = charCount + textNode.length;\n            if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i <= textNodes.length))) {\n                range.setStart(textNode, start - charCount);\n                foundStart = true;\n            }\n            if (foundStart && end <= endCharCount) {\n                range.setEnd(textNode, end - charCount);\n                break;\n            }\n            charCount = endCharCount;\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n\n        //Helper functions\n\n        function getTextNodesIn(node) {\n            var textNodes = [];\n            if (node.nodeType === 3) {\n                textNodes.push(node);\n            } else {\n                var children = node.childNodes;\n                for (var i = 0, len = children.length; i < len; ++i) {\n                    textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n                }\n            }\n            return textNodes;\n        }\n    }\n\n    //====================================================================\n\n    return (\n        <div className=\"menu_dark_bg\" onClick={hideView}>\n            <div className=\"create_input_wrapper enlarged_create_input_wrapper\">\n                <div className=\"create_input_hide\" onClick={(e) => {hideView(e, true)}}>X</div>\n                <div className=\"code_input enlarged_code_input\" onScroll={(e) => syncScroll(e, 'input')}>\n                    {loadedTxt &&\n                        <div id=\"tooltip_editor_wrapper\">\n                            <div className=\"tooltip_btn\">Code hinzufügen</div>\n                        </div>\n                    }\n                </div>\n                <div className=\"code_display enlarged_code_display\" onScroll={(e) => syncScroll(e, 'display')}>\n                    <div id=\"internal_code_display\">\n                        {\n                            codeData.length > 0 ? (\n                                codeData.map((code, i) => {\n                                    return <div className={\"ind_code_display\"} id={code.id} style={{top:code.top+'px'}} key={i}>\n                                        <input placeholder=\"Code ID\" value={code.icdCode} className=\"small_code_section\" readOnly/>\n                                        <input placeholder=\"Code Desc\" value={code.icdCodeDesc} className=\"large_code_section medium_code_section\" readOnly/>\n                                        <img className=\"remove_code_btn\" onClick={() => modifyProposal('decline', code, i)} src={decline} />\n                                        <img className=\"remove_code_btn\" onClick={() => modifyProposal('accept', code, i)} src={accept} />\n                                    </div>;\n                                })\n                            ) : (\n                                <div className=\"empty_editor\">No proposals</div>\n                            )\n                        }\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default DetailedAnalytics;\n"]},"metadata":{},"sourceType":"module"}