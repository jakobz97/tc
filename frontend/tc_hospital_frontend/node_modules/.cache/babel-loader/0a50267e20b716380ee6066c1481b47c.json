{"ast":null,"code":"var _jsxFileName = \"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/code/frontend/tc_hospital_frontend/src/components/main/coder/editor/Editor.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { fromRange } from \"xpath-range\";\nimport { v4 as uuidv4 } from 'uuid';\nimport Navbar from \"../../general/navbar/Navbar\";\nimport '../../../../styles/shared/main.css';\nimport '../../../../styles/main/coder/editor/editor.css';\nimport \"../../../../slice/authSlice\";\nimport { codeCompletionAsync, uploadCodeAsync } from \"../../../../slice/reviewSlice\";\nimport { history } from \"../../../../helpers/history\";\nimport { useDispatch } from \"react-redux\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Editor = () => {\n  _s();\n\n  const [txt, setTxt] = useState(\"Die wichtigste Klassifikation für klinische Diagnosen ist die Internationale statistische Klassifikation der Krankheiten und verwandter Gesundheitsprobleme (International Statistical Classification of Diseases and Related Health Problems, ICD). Sie wird von der WHO (World Health Organization) herausgegeben und weltweit für die Diagnosendokumentation, Todesursachenstatistik und andere medizinische Statistiken verwendet.\\n\" + \"\\n\" + \"Erste Versuche mit einer Klassifikation von Krankheiten bzw. Todesursachen gab es bereits im 18. Jahrhundert. So hat der Probst Johann Peter Süßmilch (1707-1767) eine Todesursachenstatistik für Berlin mit mehr als 80.000 Fällen veröffentlicht. Im 19. Jahrhundert wurde versucht, die Kenntnis über die Häufigkeit verschiedener Todesursachen in soziale Maßnahmen einfließen zu lassen. 1893 wurde im Auftrag des Internationalen Statistischen Instituts von dem Direktor des statistischen Amtes von Paris, Dr. Jacques Bertillot, ein systematisches Todesursachen-Verzeichnis vorgelegt, in das Erfahrungen aus Frankreich, England, Deutschland und der Schweiz eingingen. Als Grundlage diente das Prinzip der Unterscheidung zwischen Allgemeinkrankheiten und lokalisierten Organerkrankungen. Bis 1938 gab es fünf Revisionen dieses Todesursachen-Verzeichnisses. Seit 1946 liegt die Verantwortung für die ICD bei der Weltgesundheitsorganisation WHO. Neben der Definition des Verzeichnisses (6. Revision) einigte man sich damals auch auf internationale Vorschriften zur Feststellung des Grundleidens und auf die Annahme eines umfassenden Programms der internationalen Zusammenarbeit auf dem Gebiet der Bevölkerungs- und Gesundheitsstatistik.\\n\" + \"\\n\" + \"Nach umfangreichen Vorarbeiten zu Inhalt, Aufbau und Verwendungszweck der ICD wurde 1987 die 10. Revision (ICD-10) von der WHO-Vollversammlung verabschiedet. Diese Version wird weltweit für die Gesundheitsstatistik verwendet und erlaubt damit Vergleiche zwischen einzelnen Ländern. Die deutsche Fassung wird von dem Deutschen Institut für Medizinische Dokumentation und Information (DIMDI) in Köln herausgegeben. Für die Todesursachenstatistik wird die ICD-10 in Deutschland seit dem 1.1.1998 eingesetzt (ICD-10-WHO). Die aktuelle Fassung für die stationäre und vertragsärztliche ambulante Gesundheitsversorgung wird als Version ICD-10-GM (German Modification) bezeichnet. Sie enthält eine Reihe von Modifikationen für das deutsche Gesundheitssystem, insbesondere Anpassungen für die Abrechnung stationärer Leistungen mit dem diagnose-orientierten Fallpauschalensystem (DRG-System).\\n\" + \"\\n\" + \"Die ICD-10 ist als numerische (d.h. Gliederung nach Schlüsseln) und alphabetische (d.h. Gliederung nach Krankheitsbezeichnungen) Klassifikation zusammen mit den Regeln ihrer Anwendung im Buchhandel erhältlich. Die alphabetische Klassifikation wird auch als Diagnosenthesaurus bezeichnet. Die aktuelle Version der ICD-10 kann in beiden Formen auf der WWW-Seite des DIMDI gelesen werden.\");\n  const [selTxt, setSelTxt] = useState({});\n  const [tempCodes, setTempCodes] = useState([]);\n  const dispatch = useDispatch(); //todo security checks\n\n  /**\n   * @function (01) check that there is no overlapping regarding the codes\n   *           (02) highlight the code\n   *           (03) push into data structure (updates the code overview on the right side)\n   */\n\n  const addCode = () => {\n    //1\n    //let startOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n    //let endOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n    //02\n    setSelectionRange(selTxt.start, selTxt.end); //highlight(\"yellow\");\n    //03\n\n    setTempCodes(currentCodes => [...currentCodes, selTxt]); //position absolute in the container on the height of the text\n    //store in state offset top\n  };\n  /**\n   * @function (00) wait until typing ended and dispatch send to backend for code completion and wait\n   *           (01) duplicate the array\n   *           (02) find the array entry by index\n   *           (03) add code to this entry\n   * @param e is the event\n   * @param i is the index of the array element which is\n   * @param type either id or desc of the code - required for the autocompletion\n   */\n\n\n  let typingTimerEdit;\n\n  const editCode = (e, i, type) => {\n    //00\n    clearTimeout(typingTimerEdit);\n    if (!e.target.value) return;\n    typingTimerEdit = setTimeout(() => {\n      dispatch(codeCompletionAsync({\n        type: type,\n        val: e.target.value\n      })).then(res => {\n        console.log('final res', res.payload); //if more than one match is found -> open another view where user can choose from\n\n        return; //01\n\n        let newArr = [...tempCodes]; //02\n\n        let mergedObj = { ...newArr[i],\n          codeDesc: e.target.value\n        };\n        newArr[i] = mergedObj; //03\n\n        setTempCodes(newArr);\n      }).catch(err => {\n        console.log(err);\n      });\n    }, 1000);\n  };\n  /**\n   * @function (01) duplicate the array\n   *           (02) splice the array\n   *           (03) set the new temp codes\n   * @param i index of the highlight which is deleted\n   */\n\n\n  const removeTxt = i => {\n    let newArr = [...tempCodes]; //02\n\n    newArr.splice(i, 1); //03\n\n    setTempCodes(newArr);\n  };\n  /**\n   * @function (01) get all selects and positions\n   *           (02) if only cursor change takes place only hide the tooltip\n   *           (03) reposition tooltip\n   *           (04) set selected text state\n   */\n\n\n  const selector = e => {\n    //01\n    let select = window.getSelection(),\n        selectRange = select.getRangeAt(0),\n        selectPos = selectRange.getBoundingClientRect(),\n        codeInput = document.getElementsByClassName('coder_input')[0],\n        codeInputPos = codeInput.getBoundingClientRect(),\n        tooltip = document.getElementById('tooltip_editor_wrapper'); //02\n\n    if (selectPos.width < 1) return tooltip.style.display = \"none\"; //03\n\n    tooltip.style.display = \"inline\";\n    tooltip.style.top = selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop + 'px';\n    tooltip.style.left = selectPos.left - codeInputPos.left + selectPos.width / 2 - tooltip.offsetWidth / 2 + 'px'; //04\n\n    let xpath = fromRange(selectRange, codeInput);\n    setSelTxt({ ...selTxt,\n      ...{\n        val: selectRange.toString(),\n        start: xpath.startOffset,\n        end: xpath.endOffset,\n        id: uuidv4()\n      }\n    });\n  };\n  /**\n   * @function (01)\n   *           (02)\n   * @param start\n   * @param end\n   */\n\n\n  function setSelectionRange(start, end) {\n    let el = document.getElementsByClassName('coder_input')[0];\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    var textNodes = getTextNodesIn(el);\n    var foundStart = false;\n    var charCount = 0,\n        endCharCount;\n\n    for (var i = 0, textNode; textNode = textNodes[i++];) {\n      endCharCount = charCount + textNode.length;\n\n      if (!foundStart && start >= charCount && (start < endCharCount || start == endCharCount && i <= textNodes.length)) {\n        range.setStart(textNode, start - charCount);\n        foundStart = true;\n      }\n\n      if (foundStart && end <= endCharCount) {\n        range.setEnd(textNode, end - charCount);\n        break;\n      }\n\n      charCount = endCharCount;\n    }\n\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range); //Helper functions\n\n    function getTextNodesIn(node) {\n      var textNodes = [];\n\n      if (node.nodeType === 3) {\n        textNodes.push(node);\n      } else {\n        var children = node.childNodes;\n\n        for (var i = 0, len = children.length; i < len; ++i) {\n          textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n        }\n      }\n\n      return textNodes;\n    }\n  }\n  /**\n   *\n   * @param colour\n   */\n\n\n  function highlight(colour) {\n    let range, sel;\n    sel = window.getSelection();\n\n    if (sel.rangeCount && sel.getRangeAt) {\n      range = sel.getRangeAt(0);\n    }\n\n    document.designMode = \"on\";\n    sel.removeAllRanges();\n    sel.addRange(range);\n    document.execCommand(\"BackColor\", false, colour);\n    document.designMode = \"off\";\n  } // ==========================\n\n  /**\n   * @function (01) check if any codes were added - if not return\n   *           (02) fade in the final upload overview \n   */\n\n\n  const proceedUpload = () => {};\n  /**\n   * @function\n   *           (02) create a merged object of text, codes\n   *           (03) upload via dispatch and wait for success\n   *           (04) on success clear the view and let user create a new\n   */\n\n\n  const uploadCodes = () => {\n    //01\n    if (tempCodes.length < 1) return alert(\"please provide at least one code\"); //02\n\n    let codeDataObj = {\n      initialCodes: tempCodes,\n      txt: txt\n    }; //03\n\n    dispatch(uploadCodeAsync(codeDataObj)).then(res => {\n      console.log(res.payload); //04 clear the view\n    }).catch(err => {\n      console.log('error', err);\n    });\n  }; // ==========================\n\n  /**\n   * @function\n   */\n\n\n  const exportCodes = () => {};\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"center_container\",\n    children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main_center_content_wrapper\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_outer_content\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"main_outer_heading\",\n          children: \"Code editor\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_center_content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"coder_input\",\n          placeholder: \"Patientendokumentation\",\n          contentEditable: \"true\",\n          onSelect: selector,\n          children: [txt, /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"tooltip_editor_wrapper\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"tooltip_btn\",\n              onClick: addCode,\n              children: \"Code hinzuf\\xFCgen\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"tooltip_btn\",\n              onClick: removeTxt,\n              children: \"L\\xF6schen\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 259,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"code_display\",\n          children: tempCodes.map((code, i) => {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                placeholder: \"Code ID\",\n                onChange: e => editCode(e, i, 'id')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                placeholder: \"Code Desc\",\n                onChange: e => editCode(e, i, 'desc')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"remove\",\n                onClick: () => removeTxt(i),\n                children: \"L\\xF6schen\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 268,\n                columnNumber: 33\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 36\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_outer_content right_bound_outer_content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"editor_submit_btn\",\n          onClick: () => exportCodes(),\n          children: \"Codes exportieren\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"editor_submit_btn highlighted_editor_submit_btn\",\n          onClick: () => uploadCodes(),\n          children: \"Hochladen\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 247,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Editor, \"NmyBEUy9zvL0EX70SPC/1wM0yko=\", false, function () {\n  return [useDispatch];\n});\n\n_c = Editor;\nexport default Editor;\n\nvar _c;\n\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"sources":["/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/code/frontend/tc_hospital_frontend/src/components/main/coder/editor/Editor.js"],"names":["React","useState","useRef","useEffect","fromRange","v4","uuidv4","Navbar","codeCompletionAsync","uploadCodeAsync","history","useDispatch","Editor","txt","setTxt","selTxt","setSelTxt","tempCodes","setTempCodes","dispatch","addCode","setSelectionRange","start","end","currentCodes","typingTimerEdit","editCode","e","i","type","clearTimeout","target","value","setTimeout","val","then","res","console","log","payload","newArr","mergedObj","codeDesc","catch","err","removeTxt","splice","selector","select","window","getSelection","selectRange","getRangeAt","selectPos","getBoundingClientRect","codeInput","document","getElementsByClassName","codeInputPos","tooltip","getElementById","width","style","display","top","offsetHeight","scrollTop","left","offsetWidth","xpath","toString","startOffset","endOffset","id","el","range","createRange","selectNodeContents","textNodes","getTextNodesIn","foundStart","charCount","endCharCount","textNode","length","setStart","setEnd","sel","removeAllRanges","addRange","node","nodeType","push","children","childNodes","len","apply","highlight","colour","rangeCount","designMode","execCommand","proceedUpload","uploadCodes","alert","codeDataObj","initialCodes","exportCodes","map","code"],"mappings":"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","sourcesContent":["import React, {useState, useRef, useEffect} from \"react\";\nimport { fromRange } from \"xpath-range\"\nimport { v4 as uuidv4 } from 'uuid';\n\nimport Navbar from \"../../general/navbar/Navbar\";\n\nimport '../../../../styles/shared/main.css';\nimport '../../../../styles/main/coder/editor/editor.css';\n\nimport {} from \"../../../../slice/authSlice\";\nimport {codeCompletionAsync, uploadCodeAsync} from \"../../../../slice/reviewSlice\";\nimport {history} from \"../../../../helpers/history\";\n\n\nimport {useDispatch} from \"react-redux\";\n\nconst Editor = () => {\n\n    const [txt, setTxt] = useState(\"Die wichtigste Klassifikation für klinische Diagnosen ist die Internationale statistische Klassifikation der Krankheiten und verwandter Gesundheitsprobleme (International Statistical Classification of Diseases and Related Health Problems, ICD). Sie wird von der WHO (World Health Organization) herausgegeben und weltweit für die Diagnosendokumentation, Todesursachenstatistik und andere medizinische Statistiken verwendet.\\n\" +\n        \"\\n\" +\n        \"Erste Versuche mit einer Klassifikation von Krankheiten bzw. Todesursachen gab es bereits im 18. Jahrhundert. So hat der Probst Johann Peter Süßmilch (1707-1767) eine Todesursachenstatistik für Berlin mit mehr als 80.000 Fällen veröffentlicht. Im 19. Jahrhundert wurde versucht, die Kenntnis über die Häufigkeit verschiedener Todesursachen in soziale Maßnahmen einfließen zu lassen. 1893 wurde im Auftrag des Internationalen Statistischen Instituts von dem Direktor des statistischen Amtes von Paris, Dr. Jacques Bertillot, ein systematisches Todesursachen-Verzeichnis vorgelegt, in das Erfahrungen aus Frankreich, England, Deutschland und der Schweiz eingingen. Als Grundlage diente das Prinzip der Unterscheidung zwischen Allgemeinkrankheiten und lokalisierten Organerkrankungen. Bis 1938 gab es fünf Revisionen dieses Todesursachen-Verzeichnisses. Seit 1946 liegt die Verantwortung für die ICD bei der Weltgesundheitsorganisation WHO. Neben der Definition des Verzeichnisses (6. Revision) einigte man sich damals auch auf internationale Vorschriften zur Feststellung des Grundleidens und auf die Annahme eines umfassenden Programms der internationalen Zusammenarbeit auf dem Gebiet der Bevölkerungs- und Gesundheitsstatistik.\\n\" +\n        \"\\n\" +\n        \"Nach umfangreichen Vorarbeiten zu Inhalt, Aufbau und Verwendungszweck der ICD wurde 1987 die 10. Revision (ICD-10) von der WHO-Vollversammlung verabschiedet. Diese Version wird weltweit für die Gesundheitsstatistik verwendet und erlaubt damit Vergleiche zwischen einzelnen Ländern. Die deutsche Fassung wird von dem Deutschen Institut für Medizinische Dokumentation und Information (DIMDI) in Köln herausgegeben. Für die Todesursachenstatistik wird die ICD-10 in Deutschland seit dem 1.1.1998 eingesetzt (ICD-10-WHO). Die aktuelle Fassung für die stationäre und vertragsärztliche ambulante Gesundheitsversorgung wird als Version ICD-10-GM (German Modification) bezeichnet. Sie enthält eine Reihe von Modifikationen für das deutsche Gesundheitssystem, insbesondere Anpassungen für die Abrechnung stationärer Leistungen mit dem diagnose-orientierten Fallpauschalensystem (DRG-System).\\n\" +\n        \"\\n\" +\n        \"Die ICD-10 ist als numerische (d.h. Gliederung nach Schlüsseln) und alphabetische (d.h. Gliederung nach Krankheitsbezeichnungen) Klassifikation zusammen mit den Regeln ihrer Anwendung im Buchhandel erhältlich. Die alphabetische Klassifikation wird auch als Diagnosenthesaurus bezeichnet. Die aktuelle Version der ICD-10 kann in beiden Formen auf der WWW-Seite des DIMDI gelesen werden.\")\n    const [selTxt, setSelTxt] = useState({})\n    const [tempCodes, setTempCodes] = useState([])\n\n    const dispatch = useDispatch();\n\n\n\n    //todo security checks\n\n    /**\n     * @function (01) check that there is no overlapping regarding the codes\n     *           (02) highlight the code\n     *           (03) push into data structure (updates the code overview on the right side)\n     */\n    const addCode = () => {\n        //1\n        //let startOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n        //let endOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n\n        //02\n        setSelectionRange(selTxt.start, selTxt.end)\n        //highlight(\"yellow\");\n\n        //03\n        setTempCodes(currentCodes => [...currentCodes, selTxt]);\n        //position absolute in the container on the height of the text\n        //store in state offset top\n    }\n\n    /**\n     * @function (00) wait until typing ended and dispatch send to backend for code completion and wait\n     *           (01) duplicate the array\n     *           (02) find the array entry by index\n     *           (03) add code to this entry\n     * @param e is the event\n     * @param i is the index of the array element which is\n     * @param type either id or desc of the code - required for the autocompletion\n     */\n    let typingTimerEdit;\n    const editCode = (e, i, type) => {\n        //00\n        clearTimeout(typingTimerEdit);\n        if (!e.target.value) return;\n        typingTimerEdit = setTimeout(() => {\n            dispatch(codeCompletionAsync({type: type, val: e.target.value}))\n                .then((res) => {\n                    console.log('final res', res.payload)\n                    //if more than one match is found -> open another view where user can choose from\n                    return\n                    //01\n                    let newArr = [...tempCodes];\n                    //02\n                    let mergedObj = {...newArr[i], codeDesc: e.target.value}\n                    newArr[i] = mergedObj;\n                    //03\n                    setTempCodes(newArr);\n                })\n                .catch((err) => {\n                    console.log(err)\n                });\n        }, 1000);\n    }\n\n    /**\n     * @function (01) duplicate the array\n     *           (02) splice the array\n     *           (03) set the new temp codes\n     * @param i index of the highlight which is deleted\n     */\n    const removeTxt = (i) => {\n        let newArr = [...tempCodes];\n        //02\n        newArr.splice(i, 1);\n        //03\n        setTempCodes(newArr);\n    }\n\n    /**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */\n    const selector = (e) => {\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('coder_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                id: uuidv4()\n            },\n        })\n    }\n\n    /**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */\n    function setSelectionRange(start, end) {\n\n        let el = document.getElementsByClassName('coder_input')[0];\n\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var textNodes = getTextNodesIn(el);\n        var foundStart = false;\n        var charCount = 0, endCharCount;\n\n        for (var i = 0, textNode; textNode = textNodes[i++]; ) {\n            endCharCount = charCount + textNode.length;\n            if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i <= textNodes.length))) {\n                range.setStart(textNode, start - charCount);\n                foundStart = true;\n            }\n            if (foundStart && end <= endCharCount) {\n                range.setEnd(textNode, end - charCount);\n                break;\n            }\n            charCount = endCharCount;\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n\n        //Helper functions\n\n        function getTextNodesIn(node) {\n            var textNodes = [];\n            if (node.nodeType === 3) {\n                textNodes.push(node);\n            } else {\n                var children = node.childNodes;\n                for (var i = 0, len = children.length; i < len; ++i) {\n                    textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n                }\n            }\n            return textNodes;\n        }\n    }\n\n    /**\n     *\n     * @param colour\n     */\n    function highlight(colour) {\n\n        let range, sel;\n\n        sel = window.getSelection();\n        if (sel.rangeCount && sel.getRangeAt) {\n            range = sel.getRangeAt(0);\n        }\n        document.designMode = \"on\";\n        sel.removeAllRanges();\n        sel.addRange(range);\n        document.execCommand(\"BackColor\", false, colour);\n        document.designMode = \"off\";\n    }\n\n    // ==========================\n\n    /**\n     * @function (01) check if any codes were added - if not return\n     *           (02) fade in the final upload overview \n     */\n    const proceedUpload = () => {\n\n    }\n\n    /**\n     * @function\n     *           (02) create a merged object of text, codes\n     *           (03) upload via dispatch and wait for success\n     *           (04) on success clear the view and let user create a new\n     */\n    const uploadCodes = () => {\n        //01\n        if (tempCodes.length < 1) return alert(\"please provide at least one code\");\n        //02\n        let codeDataObj = {initialCodes: tempCodes, txt: txt}\n        //03\n        dispatch(uploadCodeAsync(codeDataObj))\n            .then((res) => {\n                console.log(res.payload)\n                //04 clear the view\n            })\n            .catch((err) => {\n                console.log('error', err)\n            })\n\n\n    }\n\n    // ==========================\n\n    /**\n     * @function\n     */\n    const exportCodes = () => {\n\n    }\n\n    return (\n        <div className=\"center_container\">\n            <Navbar />\n            <div className=\"main_center_content_wrapper\">\n                <div className=\"main_outer_content\">\n                    <div className=\"main_outer_heading\">Code editor</div>\n                </div>\n                <div className=\"main_center_content\">\n\n                    <div className=\"coder_input\" placeholder=\"Patientendokumentation\" contentEditable=\"true\" onSelect={selector}>\n                        {txt}\n                        <div id=\"tooltip_editor_wrapper\">\n                            <div className=\"tooltip_btn\" onClick={addCode}>Code hinzufügen</div>\n                            <div className=\"tooltip_btn\" onClick={removeTxt}>Löschen</div>\n                        </div>\n                    </div>\n                    <div className=\"code_display\">\n                        {tempCodes.map((code, i) => {\n                            return <div key={i}>\n                                {/*code.val*/}\n                                <input placeholder=\"Code ID\" onChange={(e) => editCode(e, i, 'id')}/>\n                                <input placeholder=\"Code Desc\" onChange={(e) => editCode(e, i, 'desc')}/>\n                                <div className=\"remove\" onClick={() => removeTxt(i)}>Löschen</div>\n                            </div>;\n                        })}\n                    </div>\n                </div>\n                <div className=\"main_outer_content right_bound_outer_content\">\n                    <div className=\"editor_submit_btn\" onClick={() => exportCodes()}>Codes exportieren</div>\n                    <div className=\"editor_submit_btn highlighted_editor_submit_btn\" onClick={() => uploadCodes()}>Hochladen</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}