{"ast":null,"code":"var _jsxFileName = \"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/code/frontend/tc_hospital_frontend/src/components/main/student/editor/Editor.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport '../../../../styles/shared/editor/editor.css';\nimport '../../../../styles/shared/fadein.css';\nimport { codeCompletionAsync } from \"../../../../slice/reviewSlice\";\nimport { fromRange } from \"xpath-range\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { useDispatch } from \"react-redux\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Editor = _ref => {\n  _s();\n\n  let {\n    close,\n    taskData\n  } = _ref;\n  const [selTxt, setSelTxt] = useState({});\n  const [tempCodes, setTempCodes] = useState([]);\n  const dispatch = useDispatch();\n  /**\n   * @function (01) get the dark background, the content wrapper and the inputs\n   *           (02) increase the dark background opacity\n   *           (03) fade up the content wrapper\n   *           =============\n   *           (04) ensure that the code display has the same length as the overflow text\n   */\n\n  useEffect(() => {\n    //01\n    let bg = document.querySelector('.menu_dark_bg'),\n        content = document.querySelector('.create_input_wrapper'),\n        input = document.querySelector('.create_input'); //02\n\n    bg.style.cssText = \"opacity: 100%\"; //03\n\n    content.style.marginTop = \"0\"; //04\n\n    document.getElementById('internal_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight + 'px';\n  }, []);\n  /**\n   * @function (01) get the background and content\n   *           (02) return if user clicked on the content\n   *           (03) user clicked outside of content - hide\n   *           (04) after timeout set state again to hidden\n   */\n\n  const hideCreateView = (e, forced) => {\n    //01\n    let bg = document.querySelector('.menu_dark_bg'),\n        content = document.querySelector('.create_input_wrapper'); //02\n\n    if (!forced && content.contains(e.target)) return; //03\n\n    bg.style.cssText = \"opacity: 0%\";\n    content.style.marginTop = \"150vh\"; //04\n\n    setTimeout(() => close(), 350);\n  };\n  /**\n   * @function (01) define the target\n   */\n\n\n  const syncScroll = (e, origin) => {\n    const target = origin === 'display' ? document.getElementsByClassName('code_input')[0] : document.getElementById('internal_code_display');\n    console.log(target);\n    target.scrollTop = e.currentTarget.scrollTop;\n    target.scrollLeft = e.currentTarget.scrollLeft;\n  }; //====================================================================\n\n  /**\n   * @function (01) check that there is no overlapping regarding the codes\n   *           (02) highlight the code\n   *           (03) push into data structure (updates the code overview on the right side)\n   */\n\n\n  const addCode = () => {\n    //1\n    //let startOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n    //let endOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n    //02\n    setSelectionRange(selTxt.start, selTxt.end); //highlight(\"yellow\");\n\n    console.log(selTxt); //03\n\n    setTempCodes(currentCodes => [...currentCodes, selTxt]); //04\n\n    setTimeout(() => {\n      const elem = document.getElementById(selTxt.id);\n      elem.style.top = selTxt.top + 'px';\n      elem.style.display = 'flex';\n    }, 500); //position absolute in the container on the height of the text\n    //store in state offset top\n  };\n  /**\n   * @function (01) get all selects and positions\n   *           (02) if only cursor change takes place only hide the tooltip\n   *           (03) reposition tooltip\n   *           (04) set selected text state\n   */\n\n\n  const selector = e => {\n    //01\n    let select = window.getSelection(),\n        selectRange = select.getRangeAt(0),\n        selectPos = selectRange.getBoundingClientRect(),\n        codeInput = document.getElementsByClassName('code_input')[0],\n        codeInputPos = codeInput.getBoundingClientRect(),\n        tooltip = document.getElementById('tooltip_editor_wrapper'); //02\n\n    if (selectPos.width < 1) return tooltip.style.display = \"none\"; //03\n\n    tooltip.style.display = \"inline\";\n    tooltip.style.top = selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop + 'px';\n    tooltip.style.left = selectPos.left - codeInputPos.left + selectPos.width / 2 - tooltip.offsetWidth / 2 + 'px'; //04\n\n    let xpath = fromRange(selectRange, codeInput);\n    setSelTxt({ ...selTxt,\n      ...{\n        val: selectRange.toString(),\n        start: xpath.startOffset,\n        end: xpath.endOffset,\n        top: selectPos.top - codeInputPos.top + codeInput.scrollTop,\n        id: uuidv4()\n      }\n    });\n  };\n  /**\n   * @function (01)\n   *           (02)\n   * @param start\n   * @param end\n   */\n\n\n  function setSelectionRange(start, end) {\n    let el = document.getElementsByClassName('code_input')[0];\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    var textNodes = getTextNodesIn(el);\n    var foundStart = false;\n    var charCount = 0,\n        endCharCount;\n\n    for (var i = 0, textNode; textNode = textNodes[i++];) {\n      endCharCount = charCount + textNode.length;\n\n      if (!foundStart && start >= charCount && (start < endCharCount || start == endCharCount && i <= textNodes.length)) {\n        range.setStart(textNode, start - charCount);\n        foundStart = true;\n      }\n\n      if (foundStart && end <= endCharCount) {\n        range.setEnd(textNode, end - charCount);\n        break;\n      }\n\n      charCount = endCharCount;\n    }\n\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range); //Helper functions\n\n    function getTextNodesIn(node) {\n      var textNodes = [];\n\n      if (node.nodeType === 3) {\n        textNodes.push(node);\n      } else {\n        var children = node.childNodes;\n\n        for (var i = 0, len = children.length; i < len; ++i) {\n          textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n        }\n      }\n\n      return textNodes;\n    }\n  } //====================================================================\n\n  /**\n   * @function (00) wait until typing ended and dispatch send to backend for code completion and wait\n   *           (01) duplicate the array\n   *           (02) find the array entry by index\n   *           (03) add code to this entry\n   * @param e is the event\n   * @param i is the index of the array element which is\n   * @param type either id or desc of the code - required for the autocompletion\n   */\n\n\n  let typingTimerEdit;\n\n  const editCode = (e, i, type) => {\n    //00\n    clearTimeout(typingTimerEdit);\n    if (!e.target.value) return;\n    typingTimerEdit = setTimeout(() => {\n      dispatch(codeCompletionAsync({\n        type: type,\n        val: e.target.value\n      })).then(res => {\n        console.log('final res', res.payload); //if more than one match is found -> open another view where user can choose from\n\n        return; //01\n\n        let newArr = [...tempCodes]; //02\n\n        let mergedObj = { ...newArr[i],\n          codeDesc: e.target.value\n        };\n        newArr[i] = mergedObj; //03\n\n        setTempCodes(newArr);\n      }).catch(err => {\n        console.log(err);\n      });\n    }, 1000);\n  };\n  /**\n   * @function (01) duplicate the array\n   *           (02) splice the array\n   *           (03) set the new temp codes\n   * @param i index of the highlight which is deleted\n   */\n\n\n  const removeTxt = i => {\n    let newArr = [...tempCodes]; //02\n\n    newArr.splice(i, 1); //03\n\n    setTempCodes(newArr);\n  }; // ====================================================================\n\n  /**\n   * @function\n   */\n\n\n  const compareCodes = () => {};\n  /**\n   * @function\n   */\n\n\n  const proposeCode = () => {}; //====================================================================\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"menu_dark_bg\",\n    onClick: hideCreateView,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"create_input_wrapper enlarged_create_input_wrapper\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"create_input_hide\",\n        onClick: e => {\n          hideCreateView(e, true);\n        },\n        children: \"X\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"code_input enlarged_code_input\",\n        onMouseUp: selector,\n        onScroll: e => syncScroll(e, 'input'),\n        children: [taskData.txt, /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"tooltip_editor_wrapper\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tooltip_btn\",\n            onClick: addCode,\n            children: \"Code hinzuf\\xFCgen\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"code_display enlarged_code_display\",\n        onScroll: e => syncScroll(e, 'display'),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"internal_code_display\",\n          children: tempCodes.length > 0 ? tempCodes.map((code, i) => {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ind_code_display\",\n              id: code.id,\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                placeholder: \"Code ID\",\n                onChange: e => editCode(e, i, 'id')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                placeholder: \"Code Desc\",\n                onChange: e => editCode(e, i, 'desc')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"remove\",\n                onClick: () => removeTxt(i),\n                children: \"L\\xF6schen\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 268,\n                columnNumber: 37\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 40\n            }, this);\n          }) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty_editor\",\n            children: \"Vergebe Codes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 21\n        }, this), tempCodes.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"student_compare_btn\",\n          onClick: () => compareCodes(),\n          children: \"Vergleichen\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 47\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 251,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Editor, \"wSJqQ/8yirSjdqF5RYHIWlUbHV8=\", false, function () {\n  return [useDispatch];\n});\n\n_c = Editor;\nexport default Editor;\n\nvar _c;\n\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"sources":["/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/code/frontend/tc_hospital_frontend/src/components/main/student/editor/Editor.js"],"names":["React","useEffect","useState","codeCompletionAsync","fromRange","v4","uuidv4","useDispatch","Editor","close","taskData","selTxt","setSelTxt","tempCodes","setTempCodes","dispatch","bg","document","querySelector","content","input","style","cssText","marginTop","getElementById","height","getElementsByClassName","scrollHeight","hideCreateView","e","forced","contains","target","setTimeout","syncScroll","origin","console","log","scrollTop","currentTarget","scrollLeft","addCode","setSelectionRange","start","end","currentCodes","elem","id","top","display","selector","select","window","getSelection","selectRange","getRangeAt","selectPos","getBoundingClientRect","codeInput","codeInputPos","tooltip","width","offsetHeight","left","offsetWidth","xpath","val","toString","startOffset","endOffset","el","range","createRange","selectNodeContents","textNodes","getTextNodesIn","foundStart","charCount","endCharCount","i","textNode","length","setStart","setEnd","sel","removeAllRanges","addRange","node","nodeType","push","children","childNodes","len","apply","typingTimerEdit","editCode","type","clearTimeout","value","then","res","payload","newArr","mergedObj","codeDesc","catch","err","removeTxt","splice","compareCodes","proposeCode","txt","map","code"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\n\nimport '../../../../styles/shared/editor/editor.css';\nimport '../../../../styles/shared/fadein.css';\n\nimport {codeCompletionAsync} from \"../../../../slice/reviewSlice\";\n\nimport {fromRange} from \"xpath-range\";\nimport {v4 as uuidv4} from \"uuid\";\n\nimport {useDispatch} from \"react-redux\";\n\nconst Editor = ({ close, taskData }) => {\n\n    const [selTxt, setSelTxt] = useState({})\n    const [tempCodes, setTempCodes] = useState([])\n\n    const dispatch = useDispatch();\n\n    /**\n     * @function (01) get the dark background, the content wrapper and the inputs\n     *           (02) increase the dark background opacity\n     *           (03) fade up the content wrapper\n     *           =============\n     *           (04) ensure that the code display has the same length as the overflow text\n     */\n    useEffect(() => {\n        //01\n        let bg = document.querySelector('.menu_dark_bg'),\n            content = document.querySelector('.create_input_wrapper'),\n            input = document.querySelector('.create_input');\n        //02\n        bg.style.cssText = \"opacity: 100%\";\n        //03\n        content.style.marginTop = \"0\";\n        //04\n        document.getElementById('internal_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight+'px';\n    }, [])\n\n    /**\n     * @function (01) get the background and content\n     *           (02) return if user clicked on the content\n     *           (03) user clicked outside of content - hide\n     *           (04) after timeout set state again to hidden\n     */\n    const hideCreateView = (e, forced) => {\n        //01\n        let bg = document.querySelector('.menu_dark_bg'),\n            content = document.querySelector('.create_input_wrapper');\n        //02\n        if (!forced && content.contains(e.target)) return;\n        //03\n        bg.style.cssText = \"opacity: 0%\";\n        content.style.marginTop = \"150vh\";\n        //04\n        setTimeout(() => close(), 350)\n    };\n\n    /**\n     * @function (01) define the target\n     */\n    const syncScroll = (e, origin) => {\n        const target = origin === 'display' ? document.getElementsByClassName('code_input')[0] : document.getElementById('internal_code_display')\n        console.log(target)\n        target.scrollTop = e.currentTarget.scrollTop;\n        target.scrollLeft = e.currentTarget.scrollLeft;\n    }\n\n    //====================================================================\n\n    /**\n     * @function (01) check that there is no overlapping regarding the codes\n     *           (02) highlight the code\n     *           (03) push into data structure (updates the code overview on the right side)\n     */\n    const addCode = () => {\n        //1\n        //let startOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n        //let endOverlapCheck = tempCodes.filter(code => code.start == filter.name && code.address == filter.address)\n\n        //02\n        setSelectionRange(selTxt.start, selTxt.end)\n        //highlight(\"yellow\");\n        console.log(selTxt)\n\n        //03\n        setTempCodes(currentCodes => [...currentCodes, selTxt]);\n\n        //04\n        setTimeout(() => {\n            const elem = document.getElementById(selTxt.id);\n            elem.style.top = selTxt.top+'px';\n            elem.style.display = 'flex';\n        }, 500)\n\n        //position absolute in the container on the height of the text\n        //store in state offset top\n    }\n\n    /**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */\n    const selector = (e) => {\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('code_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                top: selectPos.top - codeInputPos.top + codeInput.scrollTop,\n                id: uuidv4()\n            },\n        })\n    }\n\n    /**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */\n    function setSelectionRange(start, end) {\n\n        let el = document.getElementsByClassName('code_input')[0];\n\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var textNodes = getTextNodesIn(el);\n        var foundStart = false;\n        var charCount = 0, endCharCount;\n\n        for (var i = 0, textNode; textNode = textNodes[i++]; ) {\n            endCharCount = charCount + textNode.length;\n            if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i <= textNodes.length))) {\n                range.setStart(textNode, start - charCount);\n                foundStart = true;\n            }\n            if (foundStart && end <= endCharCount) {\n                range.setEnd(textNode, end - charCount);\n                break;\n            }\n            charCount = endCharCount;\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n\n        //Helper functions\n\n        function getTextNodesIn(node) {\n            var textNodes = [];\n            if (node.nodeType === 3) {\n                textNodes.push(node);\n            } else {\n                var children = node.childNodes;\n                for (var i = 0, len = children.length; i < len; ++i) {\n                    textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n                }\n            }\n            return textNodes;\n        }\n    }\n\n    //====================================================================\n\n    /**\n     * @function (00) wait until typing ended and dispatch send to backend for code completion and wait\n     *           (01) duplicate the array\n     *           (02) find the array entry by index\n     *           (03) add code to this entry\n     * @param e is the event\n     * @param i is the index of the array element which is\n     * @param type either id or desc of the code - required for the autocompletion\n     */\n    let typingTimerEdit;\n    const editCode = (e, i, type) => {\n        //00\n        clearTimeout(typingTimerEdit);\n        if (!e.target.value) return;\n        typingTimerEdit = setTimeout(() => {\n            dispatch(codeCompletionAsync({type: type, val: e.target.value}))\n                .then((res) => {\n                    console.log('final res', res.payload)\n                    //if more than one match is found -> open another view where user can choose from\n                    return\n                    //01\n                    let newArr = [...tempCodes];\n                    //02\n                    let mergedObj = {...newArr[i], codeDesc: e.target.value}\n                    newArr[i] = mergedObj;\n                    //03\n                    setTempCodes(newArr);\n                })\n                .catch((err) => {\n                    console.log(err)\n                });\n        }, 1000);\n    }\n\n    /**\n     * @function (01) duplicate the array\n     *           (02) splice the array\n     *           (03) set the new temp codes\n     * @param i index of the highlight which is deleted\n     */\n    const removeTxt = (i) => {\n        let newArr = [...tempCodes];\n        //02\n        newArr.splice(i, 1);\n        //03\n        setTempCodes(newArr);\n    }\n\n    // ====================================================================\n\n    /**\n     * @function\n     */\n    const compareCodes = () => {\n\n    }\n\n    /**\n     * @function\n     */\n    const proposeCode = () => {\n\n    }\n\n    //====================================================================\n\n    return (\n        <div className=\"menu_dark_bg\" onClick={hideCreateView}>\n            <div className=\"create_input_wrapper enlarged_create_input_wrapper\">\n                <div className=\"create_input_hide\" onClick={(e) => {hideCreateView(e, true)}}>X</div>\n                <div className=\"code_input enlarged_code_input\" onMouseUp={selector} onScroll={(e) => syncScroll(e, 'input')}>\n                    {taskData.txt}\n                    <div id=\"tooltip_editor_wrapper\">\n                        <div className=\"tooltip_btn\" onClick={addCode}>Code hinzufügen</div>\n                    </div>\n                </div>\n                <div className=\"code_display enlarged_code_display\" onScroll={(e) => syncScroll(e, 'display')}>\n                    <div id=\"internal_code_display\">\n                    {\n                        tempCodes.length > 0 ? (\n                            tempCodes.map((code, i) => {\n                                return <div className=\"ind_code_display\" id={code.id} key={i}>\n                                    <input placeholder=\"Code ID\" onChange={(e) => editCode(e, i, 'id')}/>\n                                    <input placeholder=\"Code Desc\" onChange={(e) => editCode(e, i, 'desc')}/>\n                                    <div className=\"remove\" onClick={() => removeTxt(i)}>Löschen</div>\n                                </div>;\n                            })\n                        ) : (\n                            <div className=\"empty_editor\">Vergebe Codes</div>\n                            )\n                    }\n                    </div>\n                    { tempCodes.length > 0 && <div className=\"student_compare_btn\" onClick={() => compareCodes()}>Vergleichen</div> }\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}