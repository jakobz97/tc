{"ast":null,"code":"import _objectSpread from\"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import'../../../styles/shared/editor/editor.css';import'../../../styles/shared/fadein.css';import{proposeCodeAsync}from\"../../../slice/reviewSlice\";import{useDispatch,useSelector}from\"react-redux\";import AnalyticsCodeItem from\"../analytics/AnalyticsCodeItem\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DetailedAnalytics=function DetailedAnalytics(_ref){var data=_ref.data,close=_ref.close;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loadedTxt=_useState2[0],setLoadedTxt=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),studentCodeData=_useState4[0],setStudentCodeData=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),coderCodeData=_useState6[0],setCoderCodeData=_useState6[1];var dispatch=useDispatch();/**\n     * @function (01) get the dark background, the content wrapper and the inputs\n     *           (02) increase the dark background opacity\n     *           (03) fade up the content wrapper\n     *           =============\n     *           (04) ensure that the code display has the same length as the overflow text\n     *           (05) ensure that the empty codes text is centered\n     *           (06) process the provided codes to display them\n     */useEffect(function(){//01\nvar bg=document.querySelector('.menu_dark_bg'),content=document.querySelector('.create_input_wrapper');//02\nbg.style.cssText=\"opacity: 100%\";//03\ncontent.style.marginTop=\"0\";//04\ndocument.getElementsByClassName('code_input')[0].innerHTML=data.review.txt;//05\nsetLoadedTxt(true);//04\ndocument.getElementById('internal_left_code_display').style.height=document.getElementsByClassName('code_input')[0].scrollHeight+'px';document.getElementById('internal_right_code_display').style.height=document.getElementsByClassName('code_input')[0].scrollHeight+'px';document.getElementById('internal_code_separator').style.height=document.getElementsByClassName('code_input')[0].scrollHeight+'px';//05\ndocument.getElementsByClassName('empty_editor')[0].style.height=document.getElementsByClassName('code_input')[0].offsetHeight+'px';//06\ndisplayCodes();},[]);/**\n     * @function (01) get the background and content\n     *           (02) return if user clicked on the content\n     *           (03) user clicked outside of content - hide\n     *           (04) after timeout set state again to hidden\n     */var hideView=function hideView(e,forced){//01\nvar bg=document.querySelector('.menu_dark_bg'),content=document.querySelector('.create_input_wrapper');//02\nif(!forced&&content.contains(e.target))return;//03\nbg.style.cssText=\"opacity: 0%\";content.style.marginTop=\"150vh\";//04\nsetTimeout(function(){return close();},350);};/**\n     * @function (01) define the target by choosing the complementary of the scrolled div\n     *           (02) assign scroll toü and scroll left to the target based on the event scrolled position\n     */var syncScroll=function syncScroll(e,origin){//01\nvar target=origin==='display'?document.getElementsByClassName('code_input')[0]:document.getElementsByClassName('code_display')[0];//02\ntarget.scrollTop=e.currentTarget.scrollTop;target.scrollLeft=e.currentTarget.scrollLeft;};//====================================================================\n/**\n     * @function (01) transform the data provided into state data and enrich with type\n     *           (02) highlight those codes which the student but not the coder has\n     *           (03) merge into state array\n     */var displayCodes=function displayCodes(){//01\nvar studentCodes=data.studentAnswer.codes.map(function(code){return _objectSpread(_objectSpread({},code),{},{type:'student'});});var coderCodes=data.review.initialCodes.map(function(code){return _objectSpread(_objectSpread({},code),{},{type:'coder'});});//02\nstudentCodes.forEach(function(code,i){if(!data.coderCoverage.intersect.includes(code.icdCode))studentCodes[i]['proposalEligible']=true;});//03\nsetStudentCodeData(studentCodes);setCoderCodeData(coderCodes);};/**\n     * @function (01) double check that this code is not included by the coder\n     *           (02) form object of all relevant ids\n     *           (03) dispatch the code to the backend\n     */var proposeCode=function proposeCode(code){//01\nif(data.coderCoverage.intersect.includes(code.icdCode))return alert('coder has already allocated this code');//02\nvar codeProposal={reviewId:data.review._id,codeProposal:code};//03\ndispatch(proposeCodeAsync(codeProposal)).then(function(res){console.log(res.payload);alert('proposed this to the coder');}).catch(function(err){console.log('err',err);});};//====================================================================\n/**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */var selector=function selector(e){/*\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('code_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                top: selectPos.top - codeInputPos.top + codeInput.scrollTop - 5,\n                id: uuidv4()\n            },\n        })\n         */};/**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */function setSelectionRange(start,end){var el=document.getElementsByClassName('code_input')[0];var range=document.createRange();range.selectNodeContents(el);var textNodes=getTextNodesIn(el);var foundStart=false;var charCount=0,endCharCount;for(var i=0,textNode;textNode=textNodes[i++];){endCharCount=charCount+textNode.length;if(!foundStart&&start>=charCount&&(start<endCharCount||start==endCharCount&&i<=textNodes.length)){range.setStart(textNode,start-charCount);foundStart=true;}if(foundStart&&end<=endCharCount){range.setEnd(textNode,end-charCount);break;}charCount=endCharCount;}var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);//Helper functions\nfunction getTextNodesIn(node){var textNodes=[];if(node.nodeType===3){textNodes.push(node);}else{var children=node.childNodes;for(var i=0,len=children.length;i<len;++i){textNodes.push.apply(textNodes,getTextNodesIn(children[i]));}}return textNodes;}}//====================================================================\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"menu_dark_bg\",onClick:hideView,children:/*#__PURE__*/_jsxs(\"div\",{className:\"create_input_wrapper enlarged_create_input_wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"create_input_hide\",onClick:function onClick(e){hideView(e,true);},children:\"X\"}),/*#__PURE__*/_jsx(\"div\",{className:\"code_input enlarged_code_input\",onScroll:function onScroll(e){return syncScroll(e,'input');},children:loadedTxt&&/*#__PURE__*/_jsx(\"div\",{id:\"tooltip_editor_wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"tooltip_btn\",children:\"Add code\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"code_display enlarged_code_display split_code_display\",onScroll:function onScroll(e){return syncScroll(e,'display');},children:[/*#__PURE__*/_jsxs(\"div\",{id:\"internal_left_code_display\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"internal_code_desc\",children:\"Coder\"}),coderCodeData.length>0?coderCodeData.map(function(code,i){return/*#__PURE__*/_jsx(AnalyticsCodeItem,{code:code,proposeCode:proposeCode});}):/*#__PURE__*/_jsx(\"div\",{className:\"empty_editor\",children:\"Codes werden geladen\"})]}),/*#__PURE__*/_jsx(\"div\",{id:\"internal_code_separator\"}),/*#__PURE__*/_jsxs(\"div\",{id:\"internal_right_code_display\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"internal_code_desc\",children:\"You\"}),studentCodeData.length>0?studentCodeData.map(function(code,i){return/*#__PURE__*/_jsx(AnalyticsCodeItem,{code:code,proposeCode:proposeCode});}):/*#__PURE__*/_jsx(\"div\",{className:\"empty_editor\",children:\"Codes werden geladen\"})]})]})]})});};export default DetailedAnalytics;","map":{"version":3,"sources":["/Users/Jakob/Desktop/TUM/Semester_01/inno_entre/tech_challenge/tc/frontend/tc_hospital_frontend/src/components/student/analytics/DetailedAnalytics.js"],"names":["React","useEffect","useState","proposeCodeAsync","useDispatch","useSelector","AnalyticsCodeItem","DetailedAnalytics","data","close","loadedTxt","setLoadedTxt","studentCodeData","setStudentCodeData","coderCodeData","setCoderCodeData","dispatch","bg","document","querySelector","content","style","cssText","marginTop","getElementsByClassName","innerHTML","review","txt","getElementById","height","scrollHeight","offsetHeight","displayCodes","hideView","e","forced","contains","target","setTimeout","syncScroll","origin","scrollTop","currentTarget","scrollLeft","studentCodes","studentAnswer","codes","map","code","type","coderCodes","initialCodes","forEach","i","coderCoverage","intersect","includes","icdCode","proposeCode","alert","codeProposal","reviewId","_id","then","res","console","log","payload","catch","err","selector","setSelectionRange","start","end","el","range","createRange","selectNodeContents","textNodes","getTextNodesIn","foundStart","charCount","endCharCount","textNode","length","setStart","setEnd","sel","window","getSelection","removeAllRanges","addRange","node","nodeType","push","children","childNodes","len","apply"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\n\nimport '../../../styles/shared/editor/editor.css';\nimport '../../../styles/shared/fadein.css';\n\nimport {proposeCodeAsync} from \"../../../slice/reviewSlice\";\nimport {useDispatch, useSelector} from \"react-redux\";\n\nimport AnalyticsCodeItem from \"../analytics/AnalyticsCodeItem\";\n\nconst DetailedAnalytics = ({ data, close }) => {\n\n    const [loadedTxt, setLoadedTxt] = useState(false);\n    const [studentCodeData, setStudentCodeData] = useState([]);\n    const [coderCodeData, setCoderCodeData] = useState([]);\n\n    const dispatch = useDispatch();\n\n    /**\n     * @function (01) get the dark background, the content wrapper and the inputs\n     *           (02) increase the dark background opacity\n     *           (03) fade up the content wrapper\n     *           =============\n     *           (04) ensure that the code display has the same length as the overflow text\n     *           (05) ensure that the empty codes text is centered\n     *           (06) process the provided codes to display them\n     */\n    useEffect(() => {\n        //01\n        let bg = document.querySelector('.menu_dark_bg'),\n            content = document.querySelector('.create_input_wrapper');\n        //02\n        bg.style.cssText = \"opacity: 100%\";\n        //03\n        content.style.marginTop = \"0\";\n        //04\n        document.getElementsByClassName('code_input')[0].innerHTML = data.review.txt;\n        //05\n        setLoadedTxt(true);\n        //04\n        document.getElementById('internal_left_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight+'px';\n        document.getElementById('internal_right_code_display').style.height = document.getElementsByClassName('code_input')[0].scrollHeight+'px';\n        document.getElementById('internal_code_separator').style.height = document.getElementsByClassName('code_input')[0].scrollHeight+'px';\n        //05\n        document.getElementsByClassName('empty_editor')[0].style.height = document.getElementsByClassName('code_input')[0].offsetHeight+'px'\n        //06\n        displayCodes();\n    }, [])\n\n    /**\n     * @function (01) get the background and content\n     *           (02) return if user clicked on the content\n     *           (03) user clicked outside of content - hide\n     *           (04) after timeout set state again to hidden\n     */\n    const hideView = (e, forced) => {\n        //01\n        let bg = document.querySelector('.menu_dark_bg'),\n            content = document.querySelector('.create_input_wrapper');\n        //02\n        if (!forced && content.contains(e.target)) return;\n        //03\n        bg.style.cssText = \"opacity: 0%\";\n        content.style.marginTop = \"150vh\";\n        //04\n        setTimeout(() => close(), 350)\n    };\n\n    /**\n     * @function (01) define the target by choosing the complementary of the scrolled div\n     *           (02) assign scroll toü and scroll left to the target based on the event scrolled position\n     */\n    const syncScroll = (e, origin) => {\n        //01\n        const target = origin === 'display' ? document.getElementsByClassName('code_input')[0] : document.getElementsByClassName('code_display')[0]\n        //02\n        target.scrollTop = e.currentTarget.scrollTop;\n        target.scrollLeft = e.currentTarget.scrollLeft;\n    }\n\n    //====================================================================\n\n    /**\n     * @function (01) transform the data provided into state data and enrich with type\n     *           (02) highlight those codes which the student but not the coder has\n     *           (03) merge into state array\n     */\n    const displayCodes = () => {\n        //01\n        let studentCodes = data.studentAnswer.codes.map(code => ({...code, type: 'student'}))\n        let coderCodes = data.review.initialCodes.map(code => ({...code, type: 'coder'}))\n        //02\n        studentCodes.forEach((code, i) => {\n            if (!data.coderCoverage.intersect.includes(code.icdCode)) studentCodes[i]['proposalEligible'] = true;\n        })\n        //03\n        setStudentCodeData(studentCodes)\n        setCoderCodeData(coderCodes)\n    }\n\n    /**\n     * @function (01) double check that this code is not included by the coder\n     *           (02) form object of all relevant ids\n     *           (03) dispatch the code to the backend\n     */\n    const proposeCode = (code) => {\n        //01\n        if (data.coderCoverage.intersect.includes(code.icdCode)) return alert('coder has already allocated this code')\n        //02\n        const codeProposal = {\n            reviewId: data.review._id,\n            codeProposal: code\n        }\n        //03\n        dispatch(proposeCodeAsync(codeProposal))\n            .then((res) => {\n                console.log(res.payload)\n                alert('proposed this to the coder')\n            })\n            .catch((err) => {\n                console.log('err', err)\n            })\n    }\n\n    //====================================================================\n\n    /**\n     * @function (01) get all selects and positions\n     *           (02) if only cursor change takes place only hide the tooltip\n     *           (03) reposition tooltip\n     *           (04) set selected text state\n     */\n    const selector = (e) => {\n        /*\n        //01\n        let select = window.getSelection(),\n            selectRange = select.getRangeAt(0),\n            selectPos = selectRange.getBoundingClientRect(),\n            codeInput = document.getElementsByClassName('code_input')[0],\n            codeInputPos = codeInput.getBoundingClientRect(),\n            tooltip = document.getElementById('tooltip_editor_wrapper');\n        //02\n        if (selectPos.width < 1) return tooltip.style.display = \"none\";\n        //03\n        tooltip.style.display = \"inline\";\n        tooltip.style.top = (selectPos.top - codeInputPos.top - tooltip.offsetHeight - 10 + codeInput.scrollTop)+'px';\n        tooltip.style.left = (selectPos.left - codeInputPos.left + selectPos.width/2 - tooltip.offsetWidth / 2)+'px';\n        //04\n        let xpath = fromRange(selectRange, codeInput)\n\n        setSelTxt({...selTxt,  ...{\n                val: selectRange.toString(),\n                start: xpath.startOffset,\n                end: xpath.endOffset,\n                top: selectPos.top - codeInputPos.top + codeInput.scrollTop - 5,\n                id: uuidv4()\n            },\n        })\n         */\n    }\n\n    /**\n     * @function (01)\n     *           (02)\n     * @param start\n     * @param end\n     */\n    function setSelectionRange(start, end) {\n\n        let el = document.getElementsByClassName('code_input')[0];\n\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var textNodes = getTextNodesIn(el);\n        var foundStart = false;\n        var charCount = 0, endCharCount;\n\n        for (var i = 0, textNode; textNode = textNodes[i++]; ) {\n            endCharCount = charCount + textNode.length;\n            if (!foundStart && start >= charCount && (start < endCharCount || (start == endCharCount && i <= textNodes.length))) {\n                range.setStart(textNode, start - charCount);\n                foundStart = true;\n            }\n            if (foundStart && end <= endCharCount) {\n                range.setEnd(textNode, end - charCount);\n                break;\n            }\n            charCount = endCharCount;\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n\n        //Helper functions\n\n        function getTextNodesIn(node) {\n            var textNodes = [];\n            if (node.nodeType === 3) {\n                textNodes.push(node);\n            } else {\n                var children = node.childNodes;\n                for (var i = 0, len = children.length; i < len; ++i) {\n                    textNodes.push.apply(textNodes, getTextNodesIn(children[i]));\n                }\n            }\n            return textNodes;\n        }\n    }\n\n    //====================================================================\n\n    return (\n        <div className=\"menu_dark_bg\" onClick={hideView}>\n            <div className=\"create_input_wrapper enlarged_create_input_wrapper\">\n                <div className=\"create_input_hide\" onClick={(e) => {hideView(e, true)}}>X</div>\n                <div className=\"code_input enlarged_code_input\" onScroll={(e) => syncScroll(e, 'input')}>\n                    {loadedTxt &&\n                        <div id=\"tooltip_editor_wrapper\">\n                            <div className=\"tooltip_btn\">Add code</div>\n                        </div>\n                    }\n                </div>\n                <div className=\"code_display enlarged_code_display split_code_display\" onScroll={(e) => syncScroll(e, 'display')}>\n                    <div id=\"internal_left_code_display\">\n                        <div className=\"internal_code_desc\">Coder</div>\n                        {\n                            coderCodeData.length > 0 ? (\n                                coderCodeData.map((code, i) => <AnalyticsCodeItem code = {code} proposeCode = {proposeCode}/>)\n                            ) : (\n                                <div className=\"empty_editor\">Codes werden geladen</div>\n                            )\n                        }\n                    </div>\n                    <div id=\"internal_code_separator\"></div>\n                    <div id=\"internal_right_code_display\">\n                        <div className=\"internal_code_desc\">You</div>\n                        {\n                            studentCodeData.length > 0 ? (\n                                studentCodeData.map((code, i) => <AnalyticsCodeItem code = {code} proposeCode = {proposeCode}/>)\n                            ) : (\n                                <div className=\"empty_editor\">Codes werden geladen</div>\n                            )\n                        }\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default DetailedAnalytics;\n"]},"metadata":{},"sourceType":"module"}